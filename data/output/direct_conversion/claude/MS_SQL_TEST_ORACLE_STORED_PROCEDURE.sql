
CREATE PROCEDURE ORDDATA.Employee AS
BEGIN
   EXECUTE ('CREATE TABLE ORDDATA.EMPLOYEE_DETAIL(
    EMPLOYEE_ID VARCHAR(50) NOT NULL,
    EMPLOYEE_FIRST_NAME VARCHAR(50) NOT NULL, 
    EMPLOYEE_LAST_NAME VARCHAR(50) NOT NULL,
    PRIMARY KEY(EMPLOYEE_ID))');
    
    EXECUTE ('CREATE TABLE ORDDATA.Designation(
    EMPLOYEE_ID INT,
    EMPLOYEE_DESIGNATION VARCHAR(50) NOT NULL,
    PRIMARY KEY(EMPLOYEE_ID))');

  -- Insert data into the table  
  EXECUTE ('INSERT INTO ORDDATA.EMPLOYEE_DETAIL (EMPLOYEE_ID, EMPLOYEE_FIRST_NAME, EMPLOYEE_LAST_NAME) VALUES (''01'', ''Uday'', ''Hegde'')');
  EXECUTE ('INSERT INTO ORDDATA.EMPLOYEE_DETAIL (EMPLOYEE_ID, EMPLOYEE_FIRST_NAME, EMPLOYEE_LAST_NAME) VALUES (''02'', ''Lalit'', ''Bakshi'')'); 
  EXECUTE ('INSERT INTO ORDDATA.EMPLOYEE_DETAIL (EMPLOYEE_ID, EMPLOYEE_FIRST_NAME, EMPLOYEE_LAST_NAME) VALUES (''03'', ''Shridhar'', ''Bhatt'')');
  
  EXECUTE ('INSERT INTO ORDDATA.Designation (EMPLOYEE_ID, EMPLOYEE_DESIGNATION) VALUES (01, ''CEO'')');
  EXECUTE ('INSERT INTO ORDDATA.Designation (EMPLOYEE_ID, EMPLOYEE_DESIGNATION) VALUES (02, ''PRESIDENT'')');  
  EXECUTE ('INSERT INTO ORDDATA.Designation (EMPLOYEE_ID, EMPLOYEE_DESIGNATION) VALUES (03, ''SVP-HR'')');
  
  EXECUTE ('SELECT a.EMPLOYEE_ID, a.EMPLOYEE_FIRST_NAME, a.EMPLOYEE_LAST_NAME, b.EMPLOYEE_DESIGNATION   
    INTO ORDDATA.Organization
    FROM ORDDATA.EMPLOYEE_DETAIL a 
    JOIN ORDDATA.Designation b
      ON a.EMPLOYEE_ID = b.EMPLOYEE_ID');
  
  COMMIT;

  -- Output message
  PRINT 'Tables created, data loaded, and joined successfully.';  
  
  -- Catch errors
  BEGIN CATCH
    -- Rollback transaction if there's an error
    ROLLBACK;
    -- Output error message 
    PRINT 'Error: ' + ERROR_MESSAGE();
    THROW;
  END CATCH;
END;
